version: '3.8'
services:
api:
image: ghcr.io/your-org/deeptea-server:${TAG:-latest}
depends_on: [postgres, redis]
environment:
DATABASE_URL: postgres://deeptea:deeptea@postgres:5432/deeptea
REDIS_URL: redis://redis:6379
ports: ["3000:3000"]
postgres:
image: postgres:15
environment:
POSTGRES_DB: deeptea
POSTGRES_USER: deeptea
POSTGRES_PASSWORD: deeptea
volumes:
- postgres_data:/var/lib/postgresql/data
redis:
image: redis:7-alpine
volumes:
postgres_data:

prometheus:
image: prom/prometheus:latest
volumes:
- ./prometheus/prometheus.yml:/etc/prometheus/prometheus.yml
- ./prometheus/alerts.yml:/etc/prometheus/alerts.yml
ports: ["9090:9090"]

grafana:
image: grafana/grafana:10.2.3
environment:
- GF_SECURITY_ADMIN_PASSWORD=admin
volumes:
- ./grafana/provisioning:/etc/grafana/provisioning
ports: ["3001:3000"]

secrets:
jwt_secret:
external: true
psp_webhook_secret:
external: true

alertmanager:
image: prom/alertmanager:latest
volumes:
- ./alertmanager/alertmanager.yml:/etc/alertmanager/alertmanager.yml
ports: ["9093:9093"]